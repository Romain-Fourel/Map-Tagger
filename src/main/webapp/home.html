<!DOCTYPE html>

<!--Despite the fact that src/main/webapp is a source folder in the eclipse project, 
    jetty-jersey server doesn't want to update home.js and home.css files
-->

<html>
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="home.css">
        <title>Map Tagger</title>
    </head>

    <body>
        <style>
            h1{
                text-decoration: underline;
                color: rgb(179, 54, 9);
            }

            .getTitle{
                font-weight: bold;
            }

            body{
                background-color: rgb(0, 0, 0);
                color: rgb(0, 64, 128);
            }
        </style>

        <script id="templateResult" type="text/template">
            
            <div>
                <%= attribute %>
            </div>
        
        </script>

        <h1>Map Tagger Website</h1>

        <p>
            <button id="getUser">get user</button>
            <button id="putUser">put user</button>
        </p>
        <p> <span class="getTitle">Get users:</span>  <br/>
            <div id="resUser"></div>
        </p>
        <p>
            <button id="getMap">get map</button>
            <button id="postMap">post map</button>
        </p>
        <p>
            <span class="getTitle">Get maps:</span> <br/>
            <div id="resMap"></div>
        </p>
        <p>
            <button id="getPlace">get place</button>
            <button id="postPlace">post place</button>
        </p>
        <p>
            <span class="getTitle">Get places:</span> <br/>
            <div id="resPlace"></div>
        </p>

        <p>END</p>

	    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        <script type="text/javascript" src="home.js"></script>

        <script type="text/javascript">
            function getServerData(url, success) {
                $.ajax({
                    method: "GET",
                    url: url,
                    dataType: "json",
                }).done(success);
            }

            function putServerData(url, data) {
                console.log("data: '" + data + "'");
                $.ajax({
                    method: "PUT",
                    data: data,
                    url: url,
                    dataType: "json",
                }).done(console.log("request done"))
                    .success(console.log("request succeed"))
                    .fail(console.log("request failed"));
            }

            function callDone(result) {
                var templateHtml = _.template($("#templateResult").html());

                var resInHtml = templateHtml({
                    "attribute": JSON.stringify(result)
                });
                $("#res" + objectUsed).append(resInHtml);

            }

            var objectUsed = "";

            /* This is like the main, is launched when the document is ready*/
            $(document).ready(function () {

                var objList = ["User", "Map", "Place"];

                //Initialization of all get buttons
                for (const obj of objList) {

                    $("#get" + obj).click(function () {
                        objectUsed = obj
                        getServerData("ws/" + obj + "/fake" + obj, callDone);
                    });
                }

                $("#putUser").click(function () {
                    var userJson = JSON.stringify({ name: "Bertrand",password:"789456", mapList: [], location: "London" });
                    console.log(userJson);
                    putServerData("ws/user/fakeUser", userJson);
                });
            });
        </script>

    </body>

</html>