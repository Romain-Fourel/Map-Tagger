<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="home.css">
        <title>Map Tagger</title>
    </head>

    <body>

        <script id="templateResult" type="text/template">
            
            <div>
                <%= attribute %>
            </div>
        
        </script>

        <h1>Map Tagger Website</h1>

        <p>
            <button id="getUser">get user</button>
            <button id="postUser">post user</button>
        </p>
        <p> <span class="getTitle">Get users:</span>  <br/>
            <div id="resUser"></div>
        </p>
        <p>
            <button id="getMap">get map</button>
            <button id="postMap">post map</button>
        </p>
        <p>
            <span class="getTitle">Get maps:</span> <br/>
            <div id="resMap"></div>
        </p>
        <p>
            <button id="getPlace">get place</button>
            <button id="postPlace">post place</button>
        </p>
        <p>
            <span class="getTitle">Get places:</span> <br/>
            <div id="resPlace"></div>
        </p>

        <p>END</p>

	    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        <script type="text/javascript" src="home.js"></script>

        <script>
        function getServerData(url, success) {
            $.ajax({
                url: url,
                dataType: "json",
            }).done(success);
        }
        
            function postServerData(url, data) {
                $.ajax({
                    type: 'POST',
                    data: data,
                    contentType :"application/json; charSet=UTF-8",
                    url: url,
                    dataType: "json",
                }).done(console.log("data "+JSON.stringify(data)+" sent"));
            }
        
        function callDone(result) {
            var templateHtml = _.template($("#templateResult").html());
        
            var resInHtml = templateHtml({
                "attribute": JSON.stringify(result)
            });
            $("#res" + objectUsed).append(resInHtml);
        
        }
        
        var objectUsed = "";
        
        /* This is like the main, is launched when the document is ready*/
        $(document).ready(function () {
        
            var objList = ["User", "Map", "Place"];
        
            //Initialization of all get buttons
            for (const obj of objList) {
        
                $("#get" + obj).click(function () {
                    objectUsed = obj
                    getServerData("ws/" + obj + "/fake" + obj, callDone);
                });
            }

            //Initialization of all post buttons
            $("#postUser").click(function () {
                var user = {name: "Bertrand", password: "789456", mapList: [], location: "London" };
                postServerData("ws/User/fakeUser", user);
            }); 
            
            $("#postMap").click(function () {
                var map = {name: "A Map"};
                postServerData("ws/User/fakeUser", map);
            });

            $("#postPlace").click(function () {
                var place = {name: "A Place"};
                postServerData("ws/User/fakeUser", place);
            });
        });

        </script>

    </body>

</html>